'use strict';

/**
 * Retrieve the user directories from google api
 */
var google = require('googleapis');
var _ = require('lodash');
var directory = google.admin('directory_v1');
var config = require('../configs/config');

/**
 * API to administer User Directory
 */
var Interface = {
  list: getUsers
};

module.exports = Interface;

/**
 * invoke google api to get directory of users
 * @param  {object}   authToken <required> secure JWT for user directories
 * @param  {object}   userParams <optional> parameters to retrieve users
 * @param  {Function} callback   for google's directory response
 * @return {function} invokes callback
 */
function getUsers(authToken, userParams, callback) {
  // @TODO: add support for pagination under Utilities
  if (!authToken) return callback(new Error('No auth token provided'));
  console.log(authToken);
  var defaultParams = {
    auth: authToken,
    customer: '',
    domain: config.domain,
    maxResults: 500,
    pageToken: ''
  };
  var params = _.extend(defaultParams, userParams);
  return directory.users.list(params, callback);
}
